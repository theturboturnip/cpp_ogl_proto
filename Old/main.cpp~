#include <SDL2/SDL.h>
#include <GL/gl.h>
#include <GL/glu.h>
#include <iostream>

const int SCREEN_WIDTH=640,SCREEN_HEIGHT=480;
SDL_Window* window=NULL;
SDL_Surface* screenSurface=NULL;
bool shouldEnd=false;
SDL_Event e;
int r=255,g=255,b=255;

void ThrowSDLError(){
  std::cout << SDL_GetError() << "\n";
}

int CreateWindow(){
  if (SDL_Init(SDL_INIT_VIDEO)!= 0){
    ThrowSDLError();
    return 1;
  }
  window=SDL_CreateWindow("SDL Test", 
			  SDL_WINDOWPOS_UNDEFINED,
			  SDL_WINDOWPOS_UNDEFINED,
			  SCREEN_WIDTH,
			  SCREEN_HEIGHT,
			  SDL_WINDOW_SHOWN);
  if (window==NULL){
    ThrowSDLError();
    return 1;
  }
  screenSurface = SDL_GetWindowSurface(window);
  return 0;
}

void EndSDL(){
  SDL_DestroyWindow(window);
  SDL_Quit();
  return;
}

void GenerateRandomColor(){
  r=rand()%256;
  g=rand()%256;
  b=rand()%256;
  SDL_FillRect(screenSurface,NULL,SDL_MapRGB(screenSurface->format,r,g,b));
  SDL_UpdateWindowSurface(window);
}

void MainLoop(){
  while (SDL_PollEvent(&e)!=0){
    if (e.type==SDL_QUIT)
      shouldEnd=true;
    else if (e.type==SDL_KEYDOWN){
      if (e.key.keysym.sym == SDLK_SPACE)
	GenerateRandomColor();
    }
  }
}

int main(){
  if (CreateWindow()==1) return 1;
  GenerateRandomColor();
  while (!shouldEnd){
    MainLoop();
  }
  EndSDL();
  return 0;
}
